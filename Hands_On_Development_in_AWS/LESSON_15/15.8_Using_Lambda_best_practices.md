# 15.8 Using Lambda best practices 
 
# Using AWS Lambda Best Practices

- **Performance and Cost Optimization**
  - Test the performance of your Lambda functions
  - Tune memory size carefully since cost is based on memory usage
  - Increasing memory also increases available CPU
  - Monitor memory utilization using CloudWatch Logs
  - Load test functions to understand real-world behavior

- **Timeout and Execution Tuning**
  - Configure timeouts based on external dependencies (e.g., network calls)
  - Account for data download time when using `/tmp` ephemeral storage
  - Do not base timeouts only on local data validation time

- **IAM and Security Best Practices**
  - Use very restrictive IAM permissions
  - Create a separate execution role per Lambda function
  - Avoid AWS-managed policies when possible
  - Follow the principle of least privilege

- **Limits and Resource Management**
  - Be aware of Lambda service limits
  - Request limit increases if needed
  - Delete unused functions to reduce regional deployment package size

- **SQS Integration Considerations**
  - Ensure Lambda processes messages before SQS visibility timeout expires
  - Default visibility timeout is 30 seconds
  - Adjust timeout or function performance accordingly

- **Monitoring and Alerts**
  - Use built-in Lambda metrics instead of custom logging for metrics
  - Configure CloudWatch Alarms for failures and errors
  - Avoid implementing metric tracking directly in code

- **Logging Best Practices**
  - Use logging libraries effectively
  - Standard output is sent to CloudWatch Logs
  - Use log levels (ERROR, WARNING) for visibility
  - Create alarms based on log pattern matching (e.g., “ERROR”)

- **VPC Configuration**
  - Attach Lambda functions to dedicated subnets within a VPC
  - Apply dedicated NACLs and route tables
  - Simplifies traffic control and troubleshooting
  - Helps identify Lambda traffic in VPC Flow Logs

- **Code Structure and Maintainability**
  - Separate the handler from core business logic
  - Branch out of the handler early for better unit testing
  - Avoid recursive code in Lambda functions

- **Execution Context Reuse**
  - Take advantage of container freeze/thaw behavior
  - Store reusable data in the `/tmp` directory (up to 500 MB)
  - Validate cached data freshness before reuse
  - Minimize re-initialization of variables on each invocation
  - Use global or static variables where appropriate

- **Environment Variables**
  - Up to 4 KB of environment variables can be passed to functions
  - Can be modified between invocations
  - Useful for configuration and secrets (when combined with secure storage)

- **Dependency Management**
  - Control and minimize dependencies
  - Include third-party libraries not provided by AWS
  - Keep deployment packages small to reduce cold start time
  - For Java functions:
    - Place dependencies in the `/lib` directory to reduce unpack time
  - Minimize dependency complexity
 
 
 ## [Context](./../context.md)